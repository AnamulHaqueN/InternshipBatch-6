type FormData = {
  title: string;
  description: string;
  assignedUser: string;
}

const showFormBtn = document.getElementById('show-form-btn') as HTMLButtonElement
const form = document.querySelector('.task-form') as HTMLFormElement;

const div = document.querySelector('#task') as HTMLDivElement;


showFormBtn.addEventListener('click', () => {
  if(form.style.display === "none") {
    form.style.display = "block";
    showFormBtn.style.display = "none";
  }
});

function displayData() {
  const storeData: FormData[] = JSON.parse(localStorage.getItem('formData') || '[]');
  if(storeData.length === 0) {
    div.innerHTML = <p> No data is found </p>;
    return;
  }
  div.innerHTML = storeData.map((item, index) => `<p><b>Title: </b> ${item.title}</p>
   <p> Description: ${item.description} </p>
   <p> Assigned User: ${item.assignedUser} </p>
   <button onclick="deleteTask(${index})">Delete</button>
   <hr>
   `)
   
  .join("");
}

(window as any).deleteTask = (index: number) => {
  const tasks: FormData[] = JSON.parse(localStorage.getItem('formData') || '[]');
  tasks.splice(index, 1); // remove the item at the given index
  localStorage.setItem('formData', JSON.stringify(tasks));
  displayData(); // re-render list
};


displayData();

form.addEventListener('submit', (e: Event) => {
  e.preventDefault();
  
  const title = (document.querySelector('#title') as HTMLInputElement).value;
  const description = (document.querySelector('#description') as HTMLInputElement).value;
  const assignedUser = (document.querySelector('#assigned-user') as HTMLInputElement).value;
  
  const data: FormData = {
    title: title,
    description: description,
    assignedUser: assignedUser
  }

  const getTask = JSON.parse(localStorage.getItem('formData') || '[]');
  getTask.push(data);

  localStorage.setItem("formData", JSON.stringify(getTask));
  displayData();

  form.style.display = "none";
  showFormBtn.style.display = "block";
  form.reset();
});



